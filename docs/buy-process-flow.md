# 买入流程规范文档

## 1. 流程概述

### 1.1 基本流程
买入流程分为4个主要步骤：
1. 保证金协商
2. 美元汇款
3. 稳定币释放
4. 交易完成

### 1.2 保证金类型
- 0%保证金：订单生成前不锁定承兑商的账户中的USDT
- 100%保证金：交易前锁定承兑商钱包中的跟交易量相同的USDT

### 1.3 聊天功能
- 每个页面必须包含聊天入口
- 聊天入口跟其他按钮放在同一行

## 2. 详细流程说明

### 2.1 第一步：保证金协商
#### 页面文件
- `margin.html`：发起保证金协商
- `margin-waiting.html`：等待对方确认

#### 功能说明
1. 保证金协商页面（margin.html）
   - 首次进入时弹出引导提示，建议先通过IM确认保证金比例
   - 选择保证金比例（0%或100%）
   - 输入保证金金额
   - 提交协商请求
   - 显示协商历史（如有）
   - 聊天入口

2. 等待确认页面（margin-waiting.html）
   - 显示等待状态
   - 提供取消选项
   - 聊天入口

#### 异常处理
- 金额输入错误
- 比例选择验证
- 协商超时
- 对方拒绝

#### 100%保证金特殊处理
1. 承兑商确认保证金比例时：
   - 立即检查承兑商钱包余额
   - 如果余额充足：
     - 锁定对应金额的USDT
     - 完成保证金比例确认
   - 如果余额不足：
     - 买方显示"等待对方确认"
     - 承兑商显示"余额不足，请补充钱包"
     - 引导承兑商从其他钱包转入USDT
     - 余额补充后自动锁定USDT

### 2.2 第二步：美元汇款
#### 页面文件
- `pay.html`：汇款信息展示和凭证上传

#### 功能说明
1. 汇款信息展示
   - 收款账户信息
   - 汇款金额
   - 汇款截止时间
   - 聊天入口

2. 凭证上传
   - 支持图片格式
   - 文件大小限制
   - 上传进度显示

3. 备注信息
   - 备注输入
   - 字符限制

#### 异常处理
- 凭证格式错误
- 上传失败
- 汇款超时
- 取消汇款

### 2.3 第三步：稳定币释放
#### 页面文件
- `waiting-usdt.html`：等待USDT释放

#### 功能说明
1. 100%保证金流程
   - 直接释放已锁定的USDT
   - 显示释放进度
   - 聊天入口

2. 0%保证金流程
   - 检查承兑商账户余额
   - 立即划转
   - 余额不足等待补充

#### 异常处理
- 余额不足
- 释放失败
- 超时处理
- 网络异常

### 2.4 第四步：交易完成
#### 页面文件
- `complete.html`：交易完成页面

#### 功能说明
1. 交易详情展示
   - 交易金额
   - 保证金信息
   - 时间信息
   - 交易状态
   - 聊天入口

2. 后续操作
   - 继续交易
   - 发起投诉
   - 查看历史

#### 异常处理
- 交易异常
- 投诉处理
- 状态同步

## 3. 页面优化建议

### 3.1 margin.html 优化
- [ ] 添加保证金比例选择说明
- [ ] 增加金额输入验证
- [ ] 优化协商历史展示
- [ ] 添加常见问题提示
- [ ] 优化聊天引导弹窗
- [ ] 完善聊天入口样式

### 3.2 margin-waiting.html 优化
- [ ] 优化等待状态展示
- [ ] 添加预计等待时间
- [ ] 完善取消流程
- [ ] 增加状态更新提示
- [ ] 优化聊天入口位置

### 3.3 pay.html 优化
- [ ] 优化收款信息展示
- [ ] 完善凭证上传功能
- [ ] 添加汇款指南
- [ ] 优化备注输入体验
- [ ] 优化聊天入口样式

### 3.4 waiting-usdt.html 优化
- [ ] 区分0%和100%保证金流程
- [ ] 优化余额不足提示
- [ ] 完善等待状态展示
- [ ] 添加自动刷新功能
- [ ] 优化聊天入口位置

### 3.5 complete.html 优化
- [ ] 优化交易详情展示
- [ ] 完善投诉入口
- [ ] 添加交易评价功能
- [ ] 优化继续交易流程
- [ ] 优化聊天入口样式