# OTC 平台 1.1 版本 Todolist （更新版）

## 开发规范
- [ ] **高保真静态原型**：创建 HTML 静态页面作为高保真原型
- [ ] **样式一致性**：保持与现有页面样式和配色一致
  - 遵循平台现有的颜色和交互规范
  - 确保新增页面与现有页面视觉风格统一
  - 复用现有组件样式和设计元素
- [ ] **布局统一**：页面布局需与现有页面保持一致
- [ ] **响应式设计**：确保在不同设备上有良好的显示效果
- [ ] **多语言支持**：支持中英文切换，默认为英文
  - 英文翻译规范参考 `docs/i18n-glossary.md`
  - 使用统一的术语表确保翻译一致性
- [ ] **组件复用**：尽可能复用现有组件
- [ ] **用户体验**：保持交互流程简洁明了
- [ ] **代码规范**：遵循项目现有的代码风格
- [ ] **图标统一**：使用统一的图标库（Font Awesome）

## 设计要求
- [ ] 所有新增页面必须保持与现有页面相同的设计语言
- [ ] 组件样式应与现有组件保持一致
- [ ] 配色方案遵循现有项目配色
- [ ] 图标使用统一的 Font Awesome 图标库
- [ ] 字体大小、行高、间距等应保持一致
- [ ] 响应式布局适配移动端和桌面端

## 1. 增加卖出流程

> **⚠️ 开发重点说明：**
> 1. **文件名严格对应**：卖出流程所有文件名必须与买入流程中的对应文件保持完全一致，禁止随意命名
> 2. **直接复制修改**：必须先复制对应的买入流程页面，再在此基础上进行必要修改，确保页面结构一致
> 3. **保持布局不变**：必须保持页面的左右两栏布局结构，聊天窗口入口等关键布局必须与买入流程保持一致
> 4. **每页自检**：完成每个页面后必须对照对应的买入流程页面进行自检，确保结构、样式和交互一致
> 5. **严格遵循规范文档**：所有开发必须严格遵循 `docs/OTC_Platform_v1.1_Development_Guidelines.md` 中的规范

- [ ] 设计卖出流程整体架构
  - 在 `trading/process/` 下创建 `sell` 目录
  - 分为 `client`（用户视角）和 `merchant`（承兑商视角）两个子目录
  - **务必直接复制** `trading/process/buy/client` 到 `trading/process/sell/client`
  - **务必直接复制** `trading/process/buy/merchant` 到 `trading/process/sell/merchant`

- [ ] 进度条步骤设计（对称于买入流程）
  - **步骤1**：保证金协商（必须保持与买入流程对应步骤相同的样式）
  - **步骤2**：创建订单（确认交易信息并创建订单）
  - **步骤3**：锁定USDT（用户向承兑商释放加密货币）
  - **步骤4**：等待付款（等待承兑商完成法币支付）
  - **步骤5**：完成（交易完成确认）

- [ ] 用户视角（client）页面实现
  - **步骤1：保证金协商**
    - `margin.html`：保证金协商页面（进度条：第1步激活）
      - **必须复制并修改** `trading/process/buy/client/margin.html`
      - 实现不同保证金比例选择（100%/0%）
      - 包含风险提示信息
      - 下一步/取消按钮处理
      - 支持中英双语，默认英语
      - **页面必须包含聊天入口**
    - `margin-waiting.html`：等待商家确认保证金页面（进度条：第1步激活）
      - **必须复制并修改** `trading/process/buy/client/margin-waiting.html`
      - 包含等待状态显示
      - 取消选项处理
      - 支持中英双语，默认英语
      - **必须包含聊天组件**
  
  - **步骤2：创建订单**
    - `create-order.html`：创建订单页面（进度条：第2步激活）
      - **必须复制并修改** `trading/process/buy/client/create-order.html`
      - 修改为卖出场景下的订单创建逻辑
      - 包含订单详情显示
      - 支持中英双语，默认英语
      - **保持与参考页面相同的表单布局**
  
  - **步骤3：锁定USDT**
    - `margin-deposit.html`：保证金划拨页面（进度条：第1步激活）
      - **必须复制并修改** `trading/process/buy/client/margin-deposit.html`
        - 从用户平台钱包中划拨资产作为保证金
        - 显示用户钱包可用余额
        - 处理余额不足情况
        - 处理划拨失败异常
        - 支持中英双语，默认英语
        - **保持与参考页面完全相同的左右两栏布局**
  
  - **步骤4：等待付款**
    - `waiting-payment.html`：等待商家付款页面（进度条：第4步激活）
      - **必须复制并修改** `trading/process/buy/client/waiting-usdt.html`
      - 加密货币已释放状态显示
      - 申诉按钮和功能
      - 取消交易选项（如适用）
      - 支持中英双语，默认英语
      - **必须包含聊天组件和状态显示**

  - `release.html`：用户释放加密货币页面（进度条：第3步激活）
    - **必须复制并修改** `trading/process/buy/client/pay.html`
      - 确认释放提示
      - 交易详情显示
      - 警告和安全提示
      - 支持中英双语，默认英语
      - **保持卡片式布局和风险提示区域**
  
  - **步骤5：完成**
    - `complete.html`：交易完成页面（进度条：第5步激活）
      - **必须复制并修改** `trading/process/buy/client/complete.html`
      - 交易成功状态
      - 查看详情选项
      - 回到交易大厅按钮
      - 支持中英双语，默认英语
      - **保持交易成功图标和信息展示布局**

- [ ] 承兑商视角（merchant）页面实现
  - **步骤1：协商保证金**
    - `margin.html`：收到保证金协商请求（进度条：第1步激活）
      - **必须复制并修改** `trading/process/buy/merchant/margin.html`
      - 接受/拒绝/修改选项
      - 不同保证金比例处理
      - 支持中英双语，默认英语
      - **保持操作区和信息区的两栏布局**

  - **步骤2-3：等待释放和支付**
    - `waiting-release.html`：等待用户划拨并锁定加密货币（进度条：第2步激活）
      - **必须复制并修改** `trading/process/buy/merchant/waiting-payment.html`
      - 不同等待状态显示
      - 取消选项
      - 支持中英双语，默认英语
      - **必须包含聊天组件和状态提示**
    - `pay.html`：上传转账凭证页面（进度条：第3步激活）
      - **必须复制并修改** `trading/process/buy/client/pay.html`
      - 给卖出用户的额度进行线下转账
      - 上传转账凭证
      - 确认和遇到问题选项
      - 支持中英双语，默认英语
      - **保持表单布局和操作按钮位置**
  
  - **步骤5：完成**
    - `complete.html`：交易完成页面（进度条：第5步激活）
      - **必须复制并修改** `trading/process/buy/merchant/complete.html`
      - 成功状态显示
      - 交易详情查看
      - 回到商家中心按钮
      - 支持中英双语，默认英语
      - **保持成功提示和信息显示区布局**
    - `cancelled.html`：交易取消页面
      - **必须复制并修改** `trading/process/buy/merchant/cancelled.html`
      - 不同取消原因处理
      - 重新接单选项
      - 支持中英双语，默认英语
      - **保持取消状态展示和原因显示布局**

- [ ] 业务逻辑调整
  - 买入流程：用户支付法币 → 承兑商确认收款 → 承兑商释放加密货币
  - 卖出流程：用户释放加密货币 → 承兑商确认收到 → 承兑商支付法币
  - 保证金处理：从平台钱包划拨 → 交易完成后自动返还 → 交易取消则根据规则返还

- [ ] 视觉设计调整
  - 遵循平台现有的颜色和交互规范
  - 保持整体风格一致，可使用不同色调区分买入/卖出
  - 只更新页面标题、按钮文案和提示信息，UI布局保持一致
  - 确保与买入流程页面的设计语言统一
  - 复用现有组件样式，保持一致的用户体验

- [ ] 状态和通知处理
  - 实现订单不同状态管理（进行中/已完成/已取消/有争议）
  - 交易状态变更通知
  - 交易异常处理流程

- [ ] 代码优化
  - 提取共享组件，减少代码重复
  - 统一错误处理和状态管理
  - 优化响应式设计

## 2. 增加中心化钱包功能
- [ ] 钱包功能架构设计
  - 分别在 `user-center/client` 和 `user-center/merchant` 目录下的资产管理页面基础上迭代
  - 升级现有的 `assets.html` 页面，增加中心化钱包功能
  - 确保钱包功能与交易流程的无缝集成

- [ ] 用户端钱包功能模块 (`user-center/client/`)
  - **资产管理主页升级**
    - 升级 `assets.html`：资产管理主页
      - 功能点：
        - 显示用户 USDT/USDC 资产余额
        - 支持不同转账网络余额显示（BTC、ETH、TRON）
        - 显示法币估值（USD）
        - 提供快捷功能入口（充值、提现、转账、交易记录）
        - 显示最近交易记录（最新5条）
        - 支持资产隐藏/显示切换
      - 潜在异常：
        - 稳定币价格获取失败时的显示策略
        - 账户被冻结时的状态提示
        - 网络连接中断时的缓存机制
        - 零资产账户的显示处理
      - 支持中英双语，默认英语
  
  - **充值功能页面**
    - 新增 `assets-deposit.html`：充值界面
      - 功能点：
        - 稳定币选择（USDT/USDC）
        - 网络选择（BTC、ETH、TRON）
        - 显示充值地址和二维码
        - 提供地址复制功能
        - 显示最低充值限额提示
        - 充值记录查询（最近10条）
        - 提供充值教程链接
      - 潜在异常：
        - 地址生成失败的处理
        - 区块链网络拥堵时的提示
        - 充值金额低于最低限额的警告
        - 稳定币与网络不匹配的错误提示
        - 充值地址复制失败的处理
      - 支持中英双语，默认英语
  
  - **提现功能页面**
    - 新增 `assets-withdraw.html`：提现界面
      - 功能点：
        - 稳定币选择（USDT/USDC）
        - 网络选择（BTC、ETH、TRON）
        - 地址输入（支持地址簿调用）
        - 金额输入（支持全部提现选项）
        - 手续费显示和计算（包括链上Gas费预估）
        - 最终到账金额预览
        - 提现二次确认弹窗
      - 潜在异常：
        - 余额不足的错误提示
        - 地址格式错误的验证
        - 提现金额低于最低限额的警告
        - 提现金额超过每日限额的处理
        - 提现地址与选择网络不匹配的警告
        - 系统维护时的提现限制提示
      - 支持中英双语，默认英语
  
  - **交易记录功能（核心组件）**
    - 新增 `assets-transactions.html`：交易记录查询界面
      - 功能点：
        - 显示所有平台交易记录（充值/提现/转账）
        - 按类型筛选交易记录
        - 按时间范围筛选
        - 显示交易状态和金额
        - 支持分页显示
        - 所有链上操作显示Gas费用
      - 支持中英双语，默认英语
    
    - 新增 `assets-transaction-details.html`：交易详情页面
      - 功能点：
        - 显示交易详细信息
        - 链上交易显示区块链确认信息
        - 链上交易显示详细Gas费用
        - 提供交易哈希值复制和区块浏览器链接
      - 支持中英双语，默认英语
  
  - **地址簿管理页面**
    - 新增 `assets-address-book.html`：地址簿管理界面
      - 功能点：
        - 地址列表显示（分页）
        - 新增地址表单
        - 地址标签设置
        - 网络类型选择（BTC、ETH、TRON）
        - 常用地址标记功能
        - 地址编辑和删除
        - 地址验证和格式检查
      - 潜在异常：
        - 地址格式错误的验证提示
        - 重复地址的添加限制
        - 地址标签重复的处理
        - 删除操作的二次确认
        - 地址簿为空时的引导提示
        - 地址簿达到上限的提示
      - 支持中英双语，默认英语

- [ ] 商家端钱包功能模块 (`user-center/merchant/`)
  - **资产管理主页升级**
    - 升级 `assets.html`：资产管理主页
      - 功能点：
        - 显示商家 USDT/USDC 资产余额
        - 支持不同转账网络余额显示（BTC、ETH、TRON）
        - 显示法币估值（USD）
        - 提供快捷功能入口（充值、提现、转账、交易记录）
        - 显示最近交易记录（最新5条）
        - 支持资产隐藏/显示切换
        - 商家专属：显示保证金锁定金额
      - 潜在异常：
        - 稳定币价格获取失败时的显示策略
        - 账户被冻结时的状态提示
        - 保证金不足时的警告提示
        - 网络连接中断时的缓存机制
      - 支持中英双语，默认英语
  
  - **充值、提现功能**
    - 参照用户端同名页面实现，保持一致性
    - 商家端特有功能：保证金充值和管理
  
  - **交易记录功能（核心组件）**
    - 新增 `assets-transactions.html`：交易记录查询界面
      - 功能点：
        - 包含用户端所有功能
        - 商家专属：保证金锁定/解锁记录
        - 商家专属：OTC交易手续费支出记录
        - 商家专属：跨商家结算记录
        - 筛选选项增加：手续费支出、保证金操作
      - 支持中英双语，默认英语
    
    - 新增 `assets-transaction-details.html`：交易详情页面
      - 功能点：
        - 包含用户端所有功能
        - 商家专属：显示手续费计算明细
        - 商家专属：保证金状态跟踪
      - 支持中英双语，默认英语
  
  - **地址簿管理**
    - 参照用户端实现，保持一致性

## 3. 简化协商保证金比例
- [ ] 保证金选项简化
  - **100%托管模式**：交易资产完全托管在平台
    - 平台托管用户资产直至交易完成
    - 交易风险较低，适合大额交易
    - 默认选择此选项
  - **无托管（直接交易）**：交易资产不托管，用户和承兑商直接交易
    - 承兑商可直接接收用户资产
    - 交易风险较高，需二次确认风险
    - 选择此选项时显示风险提示弹窗

- [ ] 需要修改的页面（四个视角）
  - **买入流程-用户视角**
    - `trading/process/buy/client/margin.html`：
      - 简化保证金选项为两种模式
      - 更新选项文案和风险说明
      - 添加"自定义托管需求"入口按钮
      - 为直接交易模式添加风险二次确认弹窗
  
  - **买入流程-承兑商视角**
    - `trading/process/buy/merchant/margin.html`：
      - 简化保证金选项为两种模式
      - 调整承兑商确认界面，匹配新的保证金模式
      - 为直接交易模式添加操作确认提示
  
  - **卖出流程-用户视角**
    - `trading/process/sell/client/margin.html`：
      - 与买入流程对应页面保持一致的模式选项
      - 考虑卖出场景下的不同风险提示文案
      - 添加"自定义托管需求"入口按钮
      - 为直接交易模式添加更强烈的风险警告
  
  - **卖出流程-承兑商视角**
    - `trading/process/sell/merchant/margin.html`：
      - 与买入流程对应页面保持一致的模式选项
      - 调整承兑商确认界面，匹配卖出流程需求

- [ ] 聊天界面保证金展示优化
  - 修改 `components/chat/index.html`：
    - 简化聊天中的保证金协商展示
    - 以文字状态消息形式展示保证金选择情况
    - 示例消息模板：
      - "您已选择100%托管模式，等待对方确认..."
      - "对方已选择无托管（直接交易），请确认是否接受"
      - "对方接受了您的100%托管模式选择"
      - "对方拒绝了无托管（直接交易），建议使用100%托管模式"
    - 使用不同颜色区分不同托管模式的状态消息
    - 无需弹窗确认，保持聊天流畅性
    - 在聊天记录中保留托管模式的协商历史

- [ ] 自定义托管需求功能
  - 在两种标准模式下添加"需要其他托管方案？"按钮
  - 点击后弹出表单收集用户具体需求：
    - 期望的托管比例（滑块选择）
    - 特殊需求说明（文本框）
    - 联系方式确认（预填）
  - 表单提交后流程：
    - 显示"需求已记录"确认信息
    - 返回标准保证金选择界面继续交易
    - 后台记录用户需求用于产品迭代


## 4. 多币种支持
- [ ] 需要改造的页面
  - **交易大厅**
    - `trading/quotes.html`：添加币种和网络筛选功能
    - `trading/merchant-detail.html`：显示商家支持的币种和网络信息
  
  - **买入流程**
    - `trading/process/buy/client/margin.html`：添加币种和网络选择
    - `trading/process/buy/client/margin-deposit.html`：针对选择币种显示不同网络选项
    - `trading/process/buy/merchant/margin.html`：展示用户选择的币种和网络
  
  - **卖出流程**
    - `trading/process/sell/client/margin.html`：添加币种和网络选择
    - `trading/process/sell/client/margin-deposit.html`：针对选择币种显示不同网络选项
    - `trading/process/sell/merchant/margin.html`：展示用户选择的币种和网络
  
  - **钱包功能**
    - `user-center/client/assets.html`：显示多币种余额
    - `user-center/client/assets-deposit.html`：支持多币种充值
    - `user-center/client/assets-withdraw.html`：支持多币种提现
    - `user-center/client/assets-transfer.html`：支持多币种转账
    - `user-center/client/assets-transactions.html`：支持多币种交易记录查询
    - 商家端对应页面同样需要更新

## 5. 交易手续费
- [ ] 需要改造的页面
  - **交易大厅**
    - `trading/quotes.html`：展示含手续费的最终价格
    - `trading/merchant-detail.html`：显示商家手续费等级信息
  
  - **买入流程**
    - `trading/process/buy/client/margin.html`：添加手续费说明和计算
    - `trading/process/buy/client/pay.html`：结算页面显示手续费明细
    - `trading/process/buy/client/complete.html`：交易完成页显示费用明细
    - `trading/process/buy/merchant/margin.html`：展示手续费信息
    - `trading/process/buy/merchant/margin-complete.html`：显示商家手续费支出
  
  - **卖出流程**
    - `trading/process/sell/client/margin.html`：添加手续费说明和计算
    - `trading/process/sell/client/release.html`：释放资产页显示手续费明细
    - `trading/process/sell/client/complete.html`：交易完成页显示费用明细
    - `trading/process/sell/merchant/margin.html`：展示手续费信息
    - `trading/process/sell/merchant/margin-complete.html`：显示商家手续费支出
  
  - **钱包功能**
    - `user-center/client/assets-transactions.html`：交易记录中显示手续费
    - `user-center/client/assets-transaction-details.html`：详情页显示手续费明细
    - 商家端对应页面同样需要更新

## 6. 安全性增强
- [ ] 提供最基础的安全保障，确保中心化钱包的安全性
- [ ] 交易密码设置与验证
- [ ] 敏感操作二次确认机制
- [ ] 异常操作提醒功能

## 交付物清单
- [ ] 完整的高保真静态 HTML 原型
- [ ] 所有页面的中英文版本
- [ ] 交互说明文档
- [ ] 页面流程图
- [ ] 各功能模块的示例截图 